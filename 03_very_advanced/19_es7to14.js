/****************************************************************************************
 * MODERN JAVASCRIPT FEATURES (ES7 â†’ ES14) â€” COMPLETE & DETAILED GUIDE (BEGINNER â†’ ADV)
 *
 * Covers:
 * âœ” ES7 (2016)
 * âœ” ES8 (2017)
 * âœ” ES9 (2018)
 * âœ” ES10 (2019)
 * âœ” ES11 (2020)
 * âœ” ES12 (2021)
 * âœ” ES13 (2022)
 * âœ” ES14 (2023)
 ****************************************************************************************/


/****************************************************************************************
 *                                   ES7 (2016)
 ****************************************************************************************/

// ES7 introduced only TWO major features:
// ---------------------------------------

/*========================================================================================
 1. Array.prototype.includes()
========================================================================================*/
//
// Checks if value exists in array (better than indexOf)
//

[1, 2, 3].includes(2);       // true
[1, 2, 3].includes(4);       // false
["a", "b"].includes("a");   // true

/*========================================================================================
 2. Exponentiation Operator (**)
========================================================================================*/

2 ** 3;  // 8
10 ** 2; // 100

/****************************************************************************************
 *                                   ES8 (2017)
 ****************************************************************************************/

// ES8 added MANY powerful features:
// ---------------------------------
// âœ” async/await
// âœ” Object.entries()
// âœ” Object.values()
// âœ” Object.getOwnPropertyDescriptors()
// âœ” String padding (padStart, padEnd)
// âœ” Trailing commas in function params

/*========================================================================================
 1. Async / Await
========================================================================================*/
//
// Syntactic sugar over Promises
// Makes async code look synchronous
//

async function fetchData() {
  const res = await fetch("/api");
  return await res.json();
}

/*========================================================================================
 2. Object.values() & Object.entries()
========================================================================================*/

const user = { name: "Rahul", age: 20 };

Object.values(user);  // ["Rahul", 20]
Object.entries(user); // [["name","Rahul"],["age",20]]

/*========================================================================================
 3. Object.getOwnPropertyDescriptors()
========================================================================================*/

Object.getOwnPropertyDescriptors(user);

/*========================================================================================
 4. String padding
========================================================================================*/

"5".padStart(3, "0"); // "005"
"5".padEnd(3, "*");   // "5**"


/****************************************************************************************
 *                                   ES9 (2018)
 ****************************************************************************************/

// Major features:
// âœ” Rest/Spread for objects
// âœ” Async Iteration (for-await-of)
// âœ” Promise.finally()

/*========================================================================================
 1. Object Rest/Spread
========================================================================================*/

const emp = { name: "Aman", age: 22, role: "dev" };

const { role, ...rest } = emp; // remove role
console.log(rest);             // { name: "Aman", age: 22 }

/*========================================================================================
 2. for-await-of (Async Iteration)
========================================================================================*/

async function* asyncGenerator() {
  yield Promise.resolve(1);
  yield Promise.resolve(2);
}

(async () => {
  for await (let value of asyncGenerator()) {
    console.log(value);
  }
})();

/*========================================================================================
 3. Promise.finally()
========================================================================================*/

fetch("/api")
  .then(res => res.json())
  .catch(err => console.error(err))
  .finally(() => console.log("Done!")); // always runs


/****************************************************************************************
 *                                   ES10 (2019)
 ****************************************************************************************/

// ES10 features:
// âœ” Array.flat()
// âœ” Array.flatMap()
// âœ” String.trimStart(), trimEnd()
// âœ” Optional catch binding
// âœ” JSON âŸ¶ stable sort

/*========================================================================================
 1. Array.flat()
========================================================================================*/

[1, [2, [3]]].flat(2); // [1,2,3]

/*========================================================================================
 2. Array.flatMap()
========================================================================================*/

[1, 2, 3].flatMap(x => [x, x * 2]);  // [1,2,2,4,3,6]

/*========================================================================================
 3. trimStart() / trimEnd()
========================================================================================*/

"   hi".trimStart(); // "hi"
"hi   ".trimEnd();   // "hi"

/*========================================================================================
 4. Optional Catch Binding
========================================================================================*/

try {
  throw new Error("oops");
} catch {
  console.log("error caught"); // no 'error' param needed
}


/****************************************************************************************
 *                                   ES11 (2020)
 ****************************************************************************************/

// ES11 Huge update:
// âœ” Optional Chaining (?.)
// âœ” Nullish Coalescing (??)
// âœ” BigInt
// âœ” Dynamic import()
// âœ” Promise.allSettled()
// âœ” globalThis
// âœ” String.matchAll()
// âœ” Module namespace exports

/*========================================================================================
 1. Optional Chaining (?.)
========================================================================================*/

const person = { profile: { age: 20 } };
person?.profile?.age;   // 20
person?.address?.city;  // undefined (safe)

/*========================================================================================
 2. Nullish Coalescing (??)
========================================================================================*/

null ?? "default";   // "default"
0 ?? 5;              // 0 (unlike ||)

/*========================================================================================
 3. BigInt
========================================================================================*/

const big = 123456789012345678901234567890n;
typeof big; // "bigint"

/*========================================================================================
 4. Dynamic import()
========================================================================================*/

import("./module.js").then(module => module.run());

/*========================================================================================
 5. Promise.allSettled()
========================================================================================*/

Promise.allSettled([
  Promise.resolve(1),
  Promise.reject("err")
]);

/*========================================================================================
 6. globalThis (Universal global object)
========================================================================================*/

globalThis === window; // browser
globalThis === global; // Node.js

/*========================================================================================
 7. String.matchAll()
========================================================================================*/

[... "a1b2c3".matchAll(/\d/g)]; // ["1","2","3"]


/****************************************************************************************
 *                                   ES12 (2021)
 ****************************************************************************************/

// Key features:
// âœ” String.replaceAll()
// âœ” Promise.any()
// âœ” WeakRef
// âœ” Logical Assignment Operators (&&=, ||=, ??=)
// âœ” Numeric separators (_)

/*========================================================================================
 1. String.replaceAll()
========================================================================================*/

"banana".replaceAll("a", "A"); // "bAnAnA"

/*========================================================================================
 2. Promise.any()
========================================================================================*/

Promise.any([
  Promise.reject(),
  Promise.resolve(5)
]).then(console.log); // 5

/*========================================================================================
 3. WeakRef (advanced memory control)
========================================================================================*/

let obj2 = { x: 10 };
const ref = new WeakRef(obj2);

/*========================================================================================
 4. Logical Assignment Operators
========================================================================================*/

let a = 0;
a ||= 5; // a = 5 if a falsy

let b = null;
b ??= 10; // b = 10 if null/undefined

/*========================================================================================
 5. Numeric Separators
========================================================================================*/

1_000_000_000; // easier to read


/****************************************************************************************
 *                                   ES13 (2022)
 ****************************************************************************************/

// Major additions:
// âœ” Top-Level await
// âœ” RegExp d flag
// âœ” Instance class fields
// âœ” Ergonomic brand checks (#private in, obj)
// âœ” Error cause

/*========================================================================================
 1. Top-Level await
========================================================================================*/

// In a module:

// const data = await fetch("/api").then(r => r.json());

/*========================================================================================
 2. Private Fields (#)
========================================================================================*/

class Bank {
  #balance = 100;
  getBalance() {
    return this.#balance;
  }
}

/*========================================================================================
 3. Error Cause
========================================================================================*/

new Error("Error occurred", { cause: "DB issue" });

/*========================================================================================
 4. Private Brand Check
========================================================================================*/

class A {
  #x;
  static hasPrivate(obj) {
    return #x in obj;
  }
}


/****************************************************************************************
 *                                   ES14 (2023)
 ****************************************************************************************/

// Features:
// âœ” Array.findLast()
// âœ” Array.findLastIndex()
// âœ” Hashbang support
// âœ” Symbols as WeakMap keys (WeakMap enhancements)

/*========================================================================================
 1. Array.findLast()
========================================================================================*/

[1, 2, 3, 4].findLast(x => x % 2 === 0); // 4

/*========================================================================================
 2. Array.findLastIndex()
========================================================================================*/

[1, 2, 3, 4].findLastIndex(x => x % 2 === 0); // 3


/****************************************************************************************
 *              MASTER SUMMARY (ES7 â†’ ES14) â€” ONE PAGE
 ****************************************************************************************/
//
// ES7 â†’ includes(), exponentiation
// ES8 â†’ async/await, Object.values, entries, string padding
// ES9 â†’ object rest/spread, async iteration, finally()
// ES10 â†’ flat(), flatMap(), trim, optional catch binding
// ES11 â†’ optional chaining, nullish, BigInt, dynamic import, allSettled()
// ES12 â†’ replaceAll(), Promise.any(), WeakRef, ||=, ??=
// ES13 â†’ top-level await, private fields, error cause
// ES14 â†’ findLast(), findLastIndex()
//
// If you master these features â†’ you fully understand MODERN JAVASCRIPT (2016â€“2023).
// ðŸš€ðŸ”¥


